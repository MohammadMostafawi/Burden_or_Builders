label == "sugar & Jam" ~ 3000,
label == "hobobat" ~ 800, # Calorie content unclear
label == "fish & chiken" ~ 2000,
label == "spices" ~ 0, # Negligible calories
label == "tomato paste" ~ 820,
label == "tea & coffee" ~ 0, # Negligible calories
label == "soda" ~ 425,
label == "biscuit & cake" ~ 4250,
label == "chips & pofak" ~ 5500,
label == "jamed oil" ~ 10000, # Calorie content unclear
label == "flour" ~ 3640,
label == "ice cream" ~ 2070,
label == "doogh" ~ 150,
label == "beer" ~ 430,
label == "curd" ~ 980,
label == "sunflower seed" ~ 5840,
label == "butter" ~ 7170,
label == "chocolate" ~ 5500,
label == "candy" ~ 3500,
TRUE ~ NA_real_
))
address_counts <- RU99P1 %>%
group_by(Address) %>%
dplyr::summarize(member = max(member, na.rm = TRUE))
average_consumption2 <- average_consumption2 %>%
mutate(total_calories = average_consumption * calories_per_kg)
# Calculate the total calories consumed in each province
average_consumption2 <- average_consumption2 %>%
# Group by Address and Province
group_by(Address, province) %>%
# Summarize total calories for each Address within each Province
dplyr::summarize(total_calories = sum(total_calories, na.rm = TRUE), .groups = 'drop') %>%
# Calculate daily calories assuming 30 days in a month
mutate(daily_calories = total_calories / 30)
average_consumption2 <- average_consumption2 %>%
left_join(address_counts, by = "Address") %>%
# Calculate the daily personal calorie consumption
mutate(daily_personal_calorie = daily_calories / member)
not_poor <- average_consumption2%>%
filter(daily_personal_calorie >= 2500)
average_consumption2 <- average_consumption2 %>%
filter(daily_personal_calorie <= 2500) %>%
group_by(province) %>%
# Summarize to find the average daily calories per Province
dplyr::summarize(bundle_calories = mean(daily_personal_calorie, na.rm = TRUE), .groups = 'drop')
#filter(daily_calories <= 2500) %>%
# Group by Province
average_consumption2 <- average_consumption2 %>%
mutate(alpha = 2100/bundle_calories)
average_consumption <- RU99P3S01_processed %>%
dplyr::group_by(Address , province, label) %>%
dplyr::summarize(average_consumption = weighted.mean(kilogram, weight, na.rm = TRUE), .groups = 'drop')
average_consumption <- average_consumption %>%
mutate(calories_per_kg = case_when(
label == "bread" ~ 2700,
label == "rice" ~ 2400,
label == "spaghetti" ~ 860,
label == "potato & pea" ~ 800,
label == "milk" ~ 500,
label == "yoghurt" ~ 500,
label == "Meat" ~ 1625, # Average for red meat and poultry
label == "egg" ~ 1300,
label == "cheese" ~ 1350,
label == "fruit" ~ 400,
label == "vegetables" ~ 200,
label == "oil" ~ 9700,
label == "sugar & Jam" ~ 3000,
label == "hobobat" ~ 800, # Calorie content unclear
label == "fish & chicken" ~ 2000,
TRUE ~ NA_real_
))
average_consumption <- average_consumption %>%
mutate(total_calories = average_consumption * calories_per_kg)
# Calculate the total calories consumed in each province
average_consumption <- average_consumption %>%
# Group by Address and Province
group_by(Address, province) %>%
# Summarize total calories for each Address within each Province
dplyr::summarize(total_calories = sum(total_calories, na.rm = TRUE), .groups = 'drop') %>%
# Calculate daily calories assuming 30 days in a month
mutate(daily_calories = total_calories / 30)
average_consumption <- average_consumption %>%
left_join(address_counts, by = "Address") %>%
# Calculate the daily personal calorie consumption
mutate(daily_personal_calorie = daily_calories / member)
average_consumption <- average_consumption %>%
filter(daily_personal_calorie <= 2500) %>%
group_by(province) %>%
# Summarize to find the average daily calories per Province
dplyr::summarize(bundle_calories = mean(daily_personal_calorie, na.rm = TRUE), .groups = 'drop')
#filter(daily_calories <= 2500) %>%
# Group by Province
average_consumption <- average_consumption %>%
mutate(beta = 2100/bundle_calories)
average_consumption <- average_consumption %>%
left_join(average_consumption2, by = "province")
average_consumption <- average_consumption %>%
arrange(-bundle_calories.x)
kable(average_consumption) %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE)
#RU99P3S01_processed <- anti_join(RU99P3S01_processed,not_poor , by = "Address")
RU99P3S01_processed <- left_join(RU99P3S01_processed,address_counts, by = "Address")
RU99P3S01_processed <- RU99P3S01_processed %>%
mutate(kilogram = kilogram / member)
# other things are present
Poverty_cost1<- RU99P3S01_processed %>%
group_by(label, province) %>%
mutate(total_product_cost = weighted_mean_price * kilogram) %>%
group_by(Address, province) %>%
summarise(total_bundle_price = sum(total_product_cost, na.rm = TRUE)) %>%
group_by(province) %>%
summarise(average_bundle_price = mean(total_bundle_price, na.rm = TRUE))
# just by photo, hazine balatar mideeeeee
Poverty_cost2<- RU99P3S01_processed %>%
group_by(label, province) %>%
mutate(total_product_cost = weighted_mean_price * kilogram) %>%
filter(!is.na(label)) %>%
group_by(Address, province) %>%
summarise(total_bundle_price = sum(total_product_cost, na.rm = TRUE)) %>%
group_by(province) %>%
summarise(average_bundle_price= mean(total_bundle_price, na.rm = TRUE))
Poverty_cost <- Poverty_cost2 %>%
left_join(Poverty_cost1, by = "province")
Poverty_cost <- Poverty_cost %>%
arrange(-average_bundle_price.x)
kable(Poverty_cost) %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE)
#halate kol
food_value <- RU99P3S01 %>%
group_by(Address, province, weight) %>%
dplyr::summarize(total_value_food= sum(value, na.rm = TRUE))
engel <- total_values_sorted %>%
left_join(food_value, by = c("Address", "province", "weight"))%>%
mutate(coeff = total_value_food / total_value, na.rm = TRUE) %>%
filter(!is.na(coeff))
weighted_engel_means <- engel %>%
group_by(province) %>%
dplyr::summarize(weighted_mean_coeff = weighted.mean(coeff, weight, na.rm = TRUE))
Total_cost_by_province2 <- Total_cost_by_province1 %>%
left_join(weighted_engel_means, by = "province")
Total_cost_by_province2 <- Total_cost_by_province2 %>%
dplyr::mutate(poverty_line = total_bundle_price / weighted_mean_coeff)
Total_cost_by_province2 <- Total_cost_by_province2 %>%
arrange(-poverty_line)
kable(Total_cost_by_province2) %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE)
# Part 4, Table 1
RU99P4S01 <- RU99P4S01 %>%
rename(
member = DYCOL01,
employed_w = DYCOL02,
ISCO_w = DYCOL03,
ISIC_w = DYCOL04,
status_w = DYCOL05,
hours_w = DYCOL06,
days_w = DYCOL07,
income_w_m = DYCOL08,
income_w_y = DYCOL09,
wage_w_m = DYCOL10,
wage_w_y = DYCOL11,
perk_w_m = DYCOL12,
perk_w_y = DYCOL13,
netincome_w_m = DYCOL14,
netincome_w_y = DYCOL15)%>%
mutate(province = fct_recode(as.factor(substr(Address, 2, 3)), !!!Province),
town = as.integer(substr(Address, 4, 5)))
# Part 4, Table 2
RU99P4S02 <- RU99P4S02 %>%
rename(
member = DYCOL01,
employed_s = DYCOL02,
ISCO_s = DYCOL03,
ISIC_s = DYCOL04,
status_s = DYCOL05,
agriculture = DYCOL06,
hours_s = DYCOL07,
days_s = DYCOL08,
cost_employment = DYCOL09,
cost_raw = DYCOL10,
cost_machinery = DYCOL11,
cost_others = DYCOL12,
cost_tax = DYCOL13,
sale = DYCOL14,
income_s_y = DYCOL15)%>%
mutate(province = fct_recode(as.factor(substr(Address, 2, 3)), !!!Province),
town = as.integer(substr(Address, 4, 5)))
# Part 4, Table 3
RU99P4S03 <- RU99P4S03 %>%
rename(
member = DYCOL01,
income_pension = DYCOL03,
income_rent = DYCOL04,
income_interest = DYCOL05,
income_aid = DYCOL06,
income_resale = DYCOL07,
income_transfer = DYCOL08)%>%
mutate(province = fct_recode(as.factor(substr(Address, 2, 3)), !!!Province),
town = as.integer(substr(Address, 4, 5)))
# Part 4, Table 4
RU99P4S04 <- RU99P4S04 %>%
rename(
member = Dycol01,
subsidy_number = Dycol03,
subsidy_month = Dycol04,
subsidy = Dycol05)%>%
mutate(province = fct_recode(as.factor(substr(Address, 2, 3)), !!!Province),
town = as.integer(substr(Address, 4, 5)))
RU99P4S03_processed <- RU99P4S03 %>%
mutate(across(starts_with("income"), ~ . / 12)) %>%
rowwise() %>%
mutate(netincome_w_m = sum(c_across(starts_with("income")), na.rm = TRUE)) %>%
select(-starts_with("income"), Address, netincome_w_m)
# Process RU99P4S04
RU99P4S04_processed <- RU99P4S04 %>%
mutate(netincome_w_m = subsidy / 12) %>%
select(Address, netincome_w_m, province)
# Process RU99P4S02
RU99P4S02_processed <- RU99P4S02 %>%
mutate(netincome_w_m = income_s_y / 12) %>%
select(Address, netincome_w_m, province)
# Combine datasets and calculate total monthly net income
combined_income <- bind_rows(RU99P4S03_processed, RU99P4S04_processed, RU99P4S02_processed) %>%
dplyr::group_by(Address, province) %>%
dplyr::summarize(total_netincome_w_m = sum(netincome_w_m, na.rm = TRUE))
# Part 4, Table 1
RU99P4S01 <- RU99P4S01 %>%
rename(
member = DYCOL01,
employed_w = DYCOL02,
ISCO_w = DYCOL03,
ISIC_w = DYCOL04,
status_w = DYCOL05,
hours_w = DYCOL06,
days_w = DYCOL07,
income_w_m = DYCOL08,
income_w_y = DYCOL09,
wage_w_m = DYCOL10,
wage_w_y = DYCOL11,
perk_w_m = DYCOL12,
perk_w_y = DYCOL13,
netincome_w_m = DYCOL14,
netincome_w_y = DYCOL15)%>%
mutate(province = fct_recode(as.factor(substr(Address, 2, 3)), !!!Province),
town = as.integer(substr(Address, 4, 5)))
poverty_line_data <- Total_cost_by_province2 %>%
select(province, poverty_line)
# Join poverty_line to combined_income
combined_income <- combined_income %>%
left_join(poverty_line_data, by = "province")
# Select required columns from RU99Data
weight_data <- RU99Data %>%
select(Address, weight)
# Join weight to combined_income
combined_income <- combined_income %>%
left_join(weight_data, by = "Address")
# Select required columns from address_counts
member_data <- address_counts %>%
select(Address, member)
# Join member to combined_income
combined_income <- combined_income %>%
left_join(member_data, by = "Address")
# Filter to keep rows where netincome_w_m is lower than poverty_line/
combined_income_filtered <- combined_income %>%
filter(total_netincome_w_m < poverty_line) %>%
mutate(total_netincome_w_m2 = total_netincome_w_m / member) %>%
mutate(asgar = total_netincome_w_m2/ poverty_line) %>%
filter(asgar > 0)
total_weight_by_province <- combined_income %>%
group_by(province) %>%
dplyr::summarize(total_province_weight = sum(weight, na.rm = TRUE))
# Next, calculate the poverty gap for each province and normalize it by the province's total weight
poverty_gap_by_province <- combined_income_filtered %>%
group_by(province) %>%
dplyr::summarize(poverty_gap = sum(weight * (1 - asgar), na.rm = TRUE)) %>%
left_join(total_weight_by_province, by = "province") %>%
mutate(poverty_gap = poverty_gap / total_province_weight)
poverty_gap_by_province <- poverty_gap_by_province %>%
arrange(poverty_gap)
kable(poverty_gap_by_province) %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE)
# income each member of khanevar
RU99P4S03_processed <- RU99P4S03 %>%
mutate(across(starts_with("income"), ~ . / 12)) %>%
rowwise() %>%
mutate(netincome_w_m = sum(c_across(starts_with("income")), na.rm = TRUE)) %>%
select(-starts_with("income"), Address, netincome_w_m, member)
# Process RU99P4S04
RU99P4S04_processed <- RU99P4S04 %>%
mutate(netincome_w_m = subsidy / 12) %>%
select(Address, netincome_w_m, province, member)
# Process RU99P4S02
RU99P4S02_processed <- RU99P4S02 %>%
mutate(netincome_w_m = income_s_y / 12) %>%
select(Address, netincome_w_m, province, member)
# Combine datasets and calculate total monthly net income
combined_income <- bind_rows(RU99P4S03_processed, RU99P4S04_processed, RU99P4S02_processed) %>%
dplyr::group_by(Address, province) %>%
dplyr::summarize(total_netincome_w_m = sum(netincome_w_m, na.rm = TRUE))
combined_income <- combined_income %>%
left_join(poverty_line_data, by = "province") %>%
left_join(address_counts, by= "Address")
combined_income <- combined_income %>%
mutate(below_poverty_line = ifelse(total_netincome_w_m / member < poverty_line, 1, 0))
# Assuming 'Address' is a common key in both datasets
RU99P1 <- RU99P1 %>%
left_join(combined_income %>% select(Address, below_poverty_line), by = "Address") %>%
mutate(below_poverty = ifelse(is.na(below_poverty_line), 0, below_poverty_line)) %>%
select(-below_poverty_line)
#food consumption
consumption <- merged_data %>%
dplyr::group_by(Address , province, label) %>%
dplyr::summarize(average_consumption = weighted.mean(kilogram, weight, na.rm = TRUE), .groups = 'drop')
consumption <- consumption %>%
mutate(calories_per_kg = case_when(
label == "bread" ~ 2700,
label == "rice" ~ 2400,
label == "spaghetti" ~ 860,
label == "potato & pea" ~ 800,
label == "milk" ~ 500,
label == "yoghurt" ~ 500,
label == "Meat" ~ 1625, # Average for red meat and poultry
label == "egg" ~ 1300,
label == "cheese" ~ 1350,
label == "fruit" ~ 400,
label == "vegetables" ~ 200,
label == "oil" ~ 9700,
label == "sugar & Jam" ~ 3000,
label == "hobobat" ~ 800, # Calorie content unclear
label == "fish & chiken" ~ 2000,
label == "spices" ~ 0, # Negligible calories
label == "tomato paste" ~ 820,
label == "tea & coffee" ~ 0, # Negligible calories
label == "soda" ~ 425,
label == "biscuit & cake" ~ 4250,
label == "chips & pofak" ~ 5500,
label == "jamed oil" ~ 10000, # Calorie content unclear
label == "flour" ~ 3640,
label == "ice cream" ~ 2070,
label == "doogh" ~ 150,
label == "beer" ~ 430,
label == "curd" ~ 980,
label == "sunflower seed" ~ 5840,
label == "butter" ~ 7170,
label == "chocolate" ~ 5500,
label == "candy" ~ 3500,
TRUE ~ NA_real_
))
consumption <- consumption %>%
mutate(total_calories = average_consumption * calories_per_kg)
# Calculate the total calories consumed in each province
consumption <- consumption %>%
# Group by Address and Province
group_by(Address, province) %>%
# Summarize total calories for each Address within each Province
dplyr::summarize(total_calories = sum(total_calories, na.rm = TRUE), .groups = 'drop') %>%
# Calculate daily calories assuming 30 days in a month
mutate(daily_calories = total_calories / 30)
# shayad ba vazn joda kardam
consumption <- consumption %>%
left_join(address_counts, by = "Address") %>%
# Calculate the daily personal calorie consumption
mutate(daily_personal_calorie = daily_calories / member)
# Join average_consumption with consumption by province
consumption <- consumption %>%
left_join(average_consumption %>% select(province, bundle_calories.x), by = "province")
# Create a dummy variable for daily_personal_calorie < bundle_calories.x
consumption <- consumption %>%
mutate(low_calorie_dummy = ifelse(daily_personal_calorie < bundle_calories.x, 1, 0))
# Assuming 'Address' is a common key in both datasets
RU99P1 <- RU99P1 %>%
left_join(consumption %>% select(Address, low_calorie_dummy), by = "Address") %>%
mutate(low_calorie_dummy = ifelse(is.na(low_calorie_dummy), 0, low_calorie_dummy))
RU99P1 <- RU99P1 %>%
group_by(Address) %>%
mutate(Head_educ = ifelse(any(relation == "head" & literacy == "illiterate", na.rm = TRUE), 1, 0),
Head_educ1 = ifelse(any(relation == "head" & education == "Elemantry", na.rm = TRUE), 1, 0)) %>%
mutate(Head_educ2 = ifelse(Head_educ == 1 | Head_educ1 == 1, 1, 0)) %>%
select(-Head_educ, -Head_educ1)
RU99P1 <- RU99P1 %>%
group_by(Address) %>%
mutate(child_not_studying = ifelse(any(relation == "child" & age >= 7 & age <= 18 & studying == "No", na.rm = TRUE), 1, 0)) %>%
ungroup()
# Create a dummy variable in rent
RU99P2 <- RU99P2 %>%
mutate(tenure_dummy = ifelse(tenure %in% c("OwnedEstateLand", "OwnedEstate", "Free"), 0, 1))
RU99P1 <- RU99P1 %>%
left_join(RU99P2 %>% select(Address, tenure_dummy), by = "Address") %>%
mutate(tenure = ifelse(is.na(tenure_dummy), 1, tenure_dummy)) %>%
select(-tenure_dummy)  # Optional: Remove the tenure_dummy column
RU99P2 <- merge(RU99P2, address_counts, by = "Address", all.x = TRUE)
# Calculate space_per_capita
RU99P2 <- RU99P2 %>%
mutate(space_per_capita = space / member)
# Create a dummy variable for space_per_capita < 16
address_space_issue <- RU99P2 %>%
mutate(space_issue = ifelse(space_per_capita < 16, 1, 0)) %>%
select(Address, space_issue)
RU99P1 <- RU99P1 %>%
left_join(address_space_issue, by = "Address") %>%
mutate(space_issue = ifelse(is.na(space_issue), 0, space_issue))
#internet
RU99P2 <- RU99P2 %>%
mutate(no_internet_dummy = ifelse(internet == "FALSE", 1, 0))
RU99P1 <- RU99P1 %>%
left_join(RU99P2 %>% select(Address, no_internet_dummy), by = "Address") %>%
mutate(no_internet_dummy = ifelse(is.na(no_internet_dummy), 0, no_internet_dummy))
#cellphone
RU99P2 <- RU99P2 %>%
mutate(no_mobile_dummy = ifelse(cellphone == "FALSE", 1, 0))
# Join this information with RU99P1
RU99P1 <- RU99P1 %>%
left_join(RU99P2 %>% select(Address, no_mobile_dummy), by = "Address") %>%
mutate(no_mobile_dummy = ifelse(is.na(no_mobile_dummy), 0, no_mobile_dummy))
RU99P2 <- RU99P2 %>%
mutate(lacks_appliances = ifelse((TV + computer + refridgerator + freezer + vehicle) < 2, 1, 0))
# Join this information with RU99P1
RU99P1 <- RU99P1 %>%
left_join(RU99P2 %>% select(Address, lacks_appliances), by = "Address") %>%
mutate(lacks_appliances = ifelse(is.na(lacks_appliances), 0, lacks_appliances))
RU99P1 <- RU99P1 %>%
rename(
below_poverty_income = below_poverty,
below_poverty_calorie = low_calorie_dummy,
head_illiterate = Head_educ2,
child_not_in_school = child_not_studying,
house_rented = tenure,
little_living_space = space_issue,
internet_access = no_internet_dummy,
cellphone_access = no_mobile_dummy,
lacks_appliances = lacks_appliances
)
multidimensional_index <- RU99P1 %>%
select(
Address,
member,
below_poverty_income,
below_poverty_calorie,
head_illiterate,
child_not_in_school,
house_rented,
little_living_space,
internet_access,
cellphone_access,
lacks_appliances
)
multidimensional_index <- multidimensional_index %>%
mutate(
province = fct_recode(as.factor(substr(Address, 2, 3)), !!!Province),
# Health Dimension (Total Weight = 1/3)
Health_Score = (below_poverty_calorie * 1/6 + below_poverty_income * 1/6),
# Education Dimension (Total Weight = 1/3)
Education_Score = (head_illiterate * 1/6 + child_not_in_school * 1/6),
# Living Standards Dimension (Total Weight = 1/3)
Living_Standards_Score = (house_rented * 1/12 + little_living_space * 1/12 +
internet_access * 1/12 + cellphone_access * 1/12 +
lacks_appliances * 1/12),
# Total MPI Score
MPI_Score = Health_Score + Education_Score + Living_Standards_Score
) %>%
select(Address, member, province, Health_Score, Education_Score, Living_Standards_Score, MPI_Score)
multidimensional_index <- multidimensional_index %>%
left_join(RU99Data %>% select(Address, weight), by = "Address")
# Calculate the weighted average of MPI scores for each province
multidimensional_index_province <- multidimensional_index %>%
group_by(province) %>%
dplyr::summarize(weighted_avg_MPI = sum(MPI_Score * weight, na.rm = TRUE) / sum(weight, na.rm = TRUE))
multidimensional_index_province <- multidimensional_index_province %>%
arrange(weighted_avg_MPI)
kable(multidimensional_index_province) %>%
kable_styling(bootstrap_options = "striped", full_width = FALSE)
# Read the shapefile
iran <- sf::st_read("/Users/ghost/Desktop/TeIAS/14021/Development I/Project/Project 2/Data/Mapping/iranmap/irn_admbnda_adm1_unhcr_20190514.shp")
iran <- rename(iran, province = ADM1_EN)
iran <- sf::st_read("/Users/ghost/Desktop/TeIAS/14021/Development I/Project/Project 2/Data/Mapping/iranmap/irn_admbnda_adm1_unhcr_20190514.shp")
iran <- rename(iran, province = ADM1_EN)
# Merge the poverty data with the shapefile data
# Ensure the column names used for merging are correct
merged_data <- merge(iran, poverty_gap_by_province, by = "province")
# Create a color palette
pal <- colorNumeric(palette = "YlOrRd", domain = merged_data$poverty_gap)
# Prepare labels for the map
labels <- sprintf(
"<strong>%s</strong><br/>Poverty Gap: %g",
merged_data$province, merged_data$poverty_gap
) %>% lapply(htmltools::HTML)
# Create the leaflet map
map <- leaflet(merged_data) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~pal(poverty_gap),
fillOpacity = 1,
weight = 0.3,
smoothFactor = 0.3,
label = labels,
labelOptions = labelOptions(
style = list("font-family" = "serif", "font-weight" = "normal", padding = "3px 8px"),
"box-shadow" = "3px 3px rgba(0,0,0,0.25)",
"font-size" = "12px",
"border-color" = "rgba(0,0,0,0.5)",
direction = "auto"),
highlightOptions = highlightOptions(color = "black", weight = 2, bringToFront = TRUE)
) %>%
addLegend(
pal = pal,
values = merged_data$poverty_gap,
position = "bottomright",
title = "Poverty Gap"
)
# Display the map
map
View(poverty_line_data)
View(poverty_gap_by_province)
